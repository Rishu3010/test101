"use strict";// To install: npm install -g babel-cli / npm install babel-preset-react babel-preset-es2015
// To compile: babel --presets react,es2015 render.jsx --out-file render.js --minified
function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function createInitialStateAndSubscribe(obj,props){return function(){var _this=this;var state={};props.forEach(function(prop){_this.props[obj][prop].subscribe(function(){_this.setState(_defineProperty({},prop,_this.props[obj][prop]()))});state[prop]=_this.props[obj][prop]()});return state}}function createOnChange(obj,prop,src){return function(e){var newValue=e.target[src||"value"];this.props[obj][prop](newValue);this.setState(_defineProperty({},prop,newValue))}}function createOnClick(obj,fun,ctx){return function(e){e.preventDefault();this.props[obj][fun](this.props[ctx],e)}}var App=React.createClass({displayName:"App",getInitialState:createInitialStateAndSubscribe("app",["loginPageVisible","mainPageVisible"]),onChangeMasterPassword:createOnClick("app","changeMasterPassword"),componentDidMount:function componentDidMount(){window.addEventListener("scroll",this.props.app.resetInactivityTimeout)},render:function render(){var context=this.props.context;var loginPage=this.state.loginPageVisible?React.createElement("div",null,React.createElement(LoginForm,{loginForm:context.loginForm}),React.createElement("div",{className:"small important"},"Important: Only use PassWeb on trusted devices!"),React.createElement(FaqList,{faqs:context.faqs}),React.createElement("div",{className:"small separate"},React.createElement("a",{href:"//github.com/DavidAnson/PassWeb"},"Open Source"),". Copyright © 2014-2016 by ",React.createElement("a",{href:"//dlaa.me/"},"David Anson"),".")):null;var mainPage=this.state.mainPageVisible?React.createElement("div",null,React.createElement(FilterBox,{userData:context.userData}),React.createElement(EntriesList,{userData:context.userData}),React.createElement(EntryForm,{entryForm:context.entryForm}),React.createElement("div",{className:"small"},React.createElement("strong",null,"Reminder"),": PassWeb resets after 3 minutes of inactivity. Unsaved edits are discarded, so save promptly!"),React.createElement("div",{className:"separate"}),React.createElement("div",{className:"small"},React.createElement("a",{onClick:this.onChangeMasterPassword,href:"#"},"[Change master password]"))):null;var resetInactivityTimeout=context.app.resetInactivityTimeout;return React.createElement("div",{onChangeCapture:resetInactivityTimeout,onClickCapture:resetInactivityTimeout},React.createElement("h1",null,"PassWeb"),loginPage,mainPage,React.createElement(Status,{status:context.status}))}});var LoginForm=React.createClass({displayName:"LoginForm",getInitialState:createInitialStateAndSubscribe("loginForm",["username","password","cache"]),onChangeUsername:createOnChange("loginForm","username"),onChangePassword:createOnChange("loginForm","password"),onChangeCache:createOnChange("loginForm","cache","checked"),onSubmit:createOnClick("loginForm","submit"),render:function render(){return React.createElement("form",{id:"loginForm",onSubmit:this.onSubmit,autoComplete:"off"},React.createElement("div",null,React.createElement("input",{type:"text",value:this.state.username,onChange:this.onChangeUsername,placeholder:"Name",required:true,autoComplete:"off"})),React.createElement("div",null,React.createElement("input",{type:"password",value:this.state.password,onChange:this.onChangePassword,placeholder:"Password",autoFocus:true,autoComplete:"off"})),React.createElement("div",null,React.createElement("input",{type:"submit",value:"Unlock"})),React.createElement("div",null,React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:this.state.cache,onChange:this.onChangeCache,autoComplete:"off"}),React.createElement("span",null,"Cache encrypted passwords for offline use"))))}});var FaqList=function FaqList(props){var nodes=props.faqs.map(function(faq,index){return React.createElement("li",{key:index},React.createElement("div",{className:"block"},React.createElement("div",{className:"question"},faq.question),React.createElement("div",{className:"answer"},faq.answer)))});return React.createElement("div",{id:"faqs",className:"separate"},React.createElement("ul",null,nodes))};var FilterBox=React.createClass({displayName:"FilterBox",getInitialState:createInitialStateAndSubscribe("userData",["filter"]),onChangeFilter:createOnChange("userData","filter"),render:function render(){return React.createElement("input",{id:"filter",type:"text",value:this.state.filter,onChange:this.onChangeFilter,placeholder:"Search",accessKey:"s"})}});var EntriesList=React.createClass({displayName:"EntriesList",componentDidMount:function componentDidMount(){var _this2=this;this.props.userData.visibleEntries.subscribe(function(){_this2.forceUpdate()})},render:function render(){var userData=this.props.userData;var visibleEntries=userData.visibleEntries().map(function(visibleEntry){var entry=visibleEntry.entry;var visible=visibleEntry.visible;return React.createElement(EntryWrapper,{key:entry.id,entry:entry,userData:userData,visible:visible})});return React.createElement("ul",{id:"entriesList"},visibleEntries)}});var EntryWrapper=React.createClass({displayName:"EntryWrapper",shouldComponentUpdate:function shouldComponentUpdate(nextProps,nextState){return this.props.entry!==nextProps.entry||this.props.visible!==nextProps.visible},render:function render(){var entry=this.props.entry;var userData=this.props.userData;return React.createElement("li",{style:{display:this.props.visible?null:"none"}},React.createElement(EntryItem,{entry:entry,userData:userData}))}});var EntryItem=React.createClass({displayName:"EntryItem",getInitialState:function getInitialState(){return{drawerOpen:false}},onClickEdit:createOnClick("userData","edit","entry"),onClickRemove:createOnClick("userData","remove","entry"),onClickCopyusername:createOnClick("userData","copyusername","entry"),onClickCopypassword:createOnClick("userData","copypassword","entry"),onToggleDrawer:function onToggleDrawer(e){e.preventDefault();this.props.userData.togglenotes(this.props.entry);this.setState({drawerOpen:!this.state.drawerOpen})},shouldComponentUpdate:function shouldComponentUpdate(nextProps,nextState){return this.props.entry!==nextProps.entry||this.state.drawerOpen!==nextState.drawerOpen},render:function render(){var dataMask="********";var entry=this.props.entry;var weakMessage=entry.reused||entry.weak;var titleTip=entry.id+(entry.insecure?" [Insecure: Not HTTPS]":"");var titleContent=entry.website?React.createElement("a",{href:entry.website,title:titleTip,target:"_blank",rel:"noopener"},entry.id):React.createElement("span",{title:titleTip},entry.id);var content=this.state.drawerOpen?React.createElement("pre",{className:"content"},entry.notes):null;var notes=entry.notes?React.createElement("div",{className:"notes"},content,React.createElement("div",{className:"drawer"},React.createElement("a",{onClick:this.onToggleDrawer,href:"#",className:"handle"},React.createElement("img",{src:"Resources/ArrowDown.svg",alt:"Notes",title:"Notes",className:"icon"})))):null;return React.createElement("div",{className:"block"},React.createElement("div",{className:"banner"},React.createElement("div",{className:"title ellipsis"+(entry.insecure?" insecure":"")},titleContent),React.createElement("a",{onClick:this.onClickEdit,href:"#",className:"edit"},React.createElement("img",{src:"Resources/Edit.svg",alt:"Edit",title:"Edit",className:"icon"})),React.createElement("a",{onClick:this.onClickRemove,href:"#",className:"remove"},React.createElement("img",{src:"Resources/Close.svg",alt:"Delete",title:"Delete",className:"icon"}))),React.createElement("div",{className:"userpass"},React.createElement("div",null," "),React.createElement("div",{className:"username"},React.createElement("a",{onClick:this.onClickCopyusername,href:"#",className:"ellipsis"},entry.username)),React.createElement("div",{className:"password"+(weakMessage?" weak":""),title:weakMessage},React.createElement("a",{onClick:this.onClickCopypassword,"data-mask":dataMask,href:"#",className:"ellipsis"},dataMask))),notes)}});var EntryForm=React.createClass({displayName:"EntryForm",getInitialState:createInitialStateAndSubscribe("entryForm",["expanded","id","username","password","website","notes","generating","passwordLength","passwordLower","passwordUpper","passwordNumbers","passwordNumbers","passwordSymbols"]),onChangeId:createOnChange("entryForm","id"),onChangeUsername:createOnChange("entryForm","username"),onChangePassword:createOnChange("entryForm","password"),onChangeWebsite:createOnChange("entryForm","website"),onChangeNotes:createOnChange("entryForm","notes"),onChangePasswordLength:createOnChange("entryForm","passwordLength"),onChangePasswordLower:createOnChange("entryForm","passwordLower","checked"),onChangePasswordUpper:createOnChange("entryForm","passwordUpper","checked"),onChangePasswordNumbers:createOnChange("entryForm","passwordNumbers","checked"),onChangePasswordSymbols:createOnChange("entryForm","passwordSymbols","checked"),onGeneratePassword:createOnClick("entryForm","generatePassword"),onClickSubmit:createOnClick("entryForm","clickSubmit",null),onSubmit:createOnClick("entryForm","submit"),onExpand:createOnClick("entryForm","expand"),onClear:createOnClick("entryForm","clear"),componentDidUpdate:function componentDidUpdate(prevProps,prevState){if(prevState.expanded!==this.state.expanded){this.formRef.scrollIntoView();this.titleRef.focus()}if(prevState.generating!==this.state.generating&&this.state.generating){this.passwordRef.select()}},enableClickToSubmit:function enableClickToSubmit(){if(this.updateRef&&this.submitRef){this.updateRef.submit=this.submitRef;this.updateRef=this.submitRef=null}},render:function render(){var _this3=this;var passwordSettings=null;if(this.state.generating){var radioLabels=["8","12","16","24","32"].map(function(len){var name="passwordLength";var id=name+len;return React.createElement("span",{key:len,className:"radioLabel"},React.createElement("input",{type:"radio",name:name,checked:_this3.state.passwordLength===len,onChange:_this3.onChangePasswordLength,value:len,id:id}),React.createElement("label",{htmlFor:id},len))});var checkboxLabel=function checkboxLabel(id,label){var handler=_this3["onChangeP"+id.slice(1)];return React.createElement("span",{className:"checkLabel"},React.createElement("input",{type:"checkbox",checked:_this3.state[id],onChange:handler,id:id}),React.createElement("label",{htmlFor:id},label))};passwordSettings=React.createElement("div",{className:"passwordSettings"},React.createElement("div",null,radioLabels),React.createElement("div",null,checkboxLabel("passwordLower","Lower-case"),checkboxLabel("passwordUpper","Upper-case")),React.createElement("div",null,checkboxLabel("passwordNumbers","Numbers"),checkboxLabel("passwordSymbols","Symbols")))}var content=this.state.expanded?React.createElement("div",null,React.createElement("div",null,React.createElement("input",{type:"text",value:this.state.id,onChange:this.onChangeId,accessKey:"n",placeholder:"Title",required:true,autoFocus:true,ref:function ref(e){return _this3.titleRef=e}})),React.createElement("div",null,React.createElement("input",{type:"text",value:this.state.username,onChange:this.onChangeUsername,placeholder:"User name"})),React.createElement("div",null,React.createElement("input",{type:this.state.generating?"text":"password",value:this.state.password,onChange:this.onChangePassword,placeholder:"Password",required:true,ref:function ref(e){return _this3.passwordRef=e}})),React.createElement("div",null,React.createElement("input",{type:"url",value:this.state.website,onChange:this.onChangeWebsite,placeholder:"URL"})),React.createElement("div",null,React.createElement("textarea",{value:this.state.notes,onChange:this.onChangeNotes,rows:"3",placeholder:"Notes"})),React.createElement("div",{className:"buttons"},React.createElement("a",{onClick:this.onGeneratePassword,href:"#",className:"generate",accessKey:"g"},React.createElement("img",{src:"Resources/Lock.svg",alt:"Generate password",title:"Generate password",className:"icon"})),React.createElement("a",{onClick:this.onClickSubmit,href:"#",className:"update",ref:function ref(e){_this3.updateRef=e;_this3.enableClickToSubmit()}},React.createElement("img",{src:"Resources/Save.svg",alt:"Save",title:"Save",className:"icon"})),React.createElement("a",{onClick:this.onClear,href:"#",className:"clear"},React.createElement("img",{src:"Resources/Undo.svg",alt:"Clear",title:"Clear",className:"icon"}))),React.createElement("input",{type:"submit",tabIndex:"-1",ref:function ref(e){_this3.submitRef=e;_this3.enableClickToSubmit()}}),passwordSettings):React.createElement("div",null,React.createElement("a",{onClick:this.onExpand,accessKey:"n",href:"#"},"New entry..."));return React.createElement("form",{id:"entryForm",onSubmit:this.onSubmit,autoComplete:"off",ref:function ref(e){return _this3.formRef=e}},content)}});var Status=React.createClass({displayName:"Status",getInitialState:createInitialStateAndSubscribe("status",["progress","errors"]),onRemove:function onRemove(error,e){e.preventDefault();this.props.status.removeError(error)},render:function render(){var _this4=this;var waiting=this.state.progress?React.createElement("div",null,React.createElement("img",{src:"Resources/Waiting.svg",alt:"Busy",title:"Busy",className:"icon"}),React.createElement("span",null,this.state.progress)):null;var errors=this.state.errors.map(function(error){return React.createElement("li",{key:error.id},React.createElement("span",{className:"dismiss"},React.createElement("a",{onClick:_this4.onRemove.bind(_this4,error),href:"#",className:"remove"},React.createElement("img",{src:"Resources/Close.svg",alt:"Dismiss",title:"Dismiss",className:"icon"}))),React.createElement("img",{src:"Resources/Warning.svg",alt:"Warning",title:"Warning",className:"icon"}),React.createElement("span",null,error.message))});return React.createElement("div",{id:"status"},waiting,React.createElement("ul",null,errors))}});function render(context){ReactDOM.render(React.createElement(App,{context:context,app:context.app}),document.getElementById("appContainer"))}// Simple replacement for Knockout.js observable
function observable(initial){var value=initial;var observers=[];var obj=function obj(newValue,forceUpdate){if(!arguments.length){return value}if(value!==newValue||forceUpdate){value=newValue;observers.forEach(function(observer){observer(value)})}};obj.subscribe=function(cb){observers.push(cb)};return obj}// Simple replacement for jQuery ajax
function ajax(uri,type,data,done,fail,always){var noop=function noop(){};done=done||noop;fail=fail||noop;always=always||noop;var request=new XMLHttpRequest;request.onload=function(){if(request.status>=200&&request.status<300){done(request.responseText)}else{fail()}};request.onerror=function(){fail()};request.onloadend=function(){always()};var encodeFormUrlComponent=function encodeFormUrlComponent(str){return encodeURIComponent(str).replace("%20","+")};var urlencoded=Object.keys(data).filter(function(key){return data[key]!==undefined&&data[key]!==null}).map(function(key){return encodeFormUrlComponent(key)+"="+encodeFormUrlComponent(data[key])}).join("&");if(type.toLowerCase()==="get"){uri+="?"+urlencoded+"&_="+Date.now();urlencoded=null}request.open(type,uri);request.setRequestHeader("X-Requested-With","XMLHttpRequest");if(urlencoded){request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}request.send(urlencoded)}
